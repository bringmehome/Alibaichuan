<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,user-scalable=0">
		<title>APICloud</title>
		<style>
			body {
				background-color: #ffffff;
			}
			.main {
				padding: 20px 0;
				/*border: 1px solid #c3c3c3;*/
				display: flex;
				justify-content: space-between;
			}
			.contain {
				padding: 10px 0;
				display: flex;
				justify-content: space-between;
			}
			.contain div {
				font-size: 12px;
				color: #575758;
				text-align: left;
			}
			.main div {
				width: 28%;
				font-size: 12px;
				color: #575758;
				padding: 10px 0;
				text-align: center;
			}
			.button1 {
				background-color: coral;
			}
			.button2 {
				background-color: lightblue;
			}
			.button3 {
				background-color: khaki;
			}
			.button4 {
				background-color: pink;
			}
			.imgclass {
				width: 50px;
				height: 50px;
			}
			.myinfoclass {
				width: 70%;
			}
			.ctrlclass {
				padding: 30px;
				text-align: center;
				font-size: 30px;
				color: #2DBD00;
				font-weight: bolder;
			}
		</style>
	</head>
	<body>
		<div class="ctrlclass">
			FeelingLife
		</div>
		<div class="main">
			<div class="button1" onclick="getAliOpen()">
				授权登录
			</div>
			<div class="button1" onclick="logout()">
				退出登录
			</div>
		</div>
		<div class="main">
			<div class="button2" onclick="getUserInfo()">
				获取用户信息
			</div>
			<div class="button3" onclick="openMyCart()">
				我的购物车
			</div>
			<div class="button4" onclick="myOrdersPage()">
				我的订单
			</div>
		</div>
		<div class="main">
			<div class="button4" onclick="openScanner()">
				打开二维码
			</div>
			<div class="button3" onclick="showTaokeItemById()">
				打开宝贝ItemID
			</div>
			<div class="button2" onclick="showTaokeItemByOpenId()">
				打开宝贝OpenId
			</div>
		</div>
		<div class="contain">
			<div><img src="" class="imgclass" id="mayicon" />
			</div>
			<div class="myinfoclass" id="myinfo"></div>
		</div>
	</body>
	<script type="text/javascript" src="./script/api.js"></script>
	<script type="text/javascript">
		var alibaichuan = null;
		var chromedebug = null;
		apiready = function() {
			chromedebug = api.require('chromeDebug');
			alibaichuan = api.require('alibaichuan');
			openchromelog();
		};
		function openchromelog() {
			chromedebug.openDebug(function(ret, err) {
				if (212 == ret.code) {
					alert(JSON.stringify(ret));
				} else {
					console.log(ret);
				}
			});
		}

		//			打开扫描二维码
		function openScanner() {
			var obj = api.require('scanner');
			obj.open(function(ret, err) {
				if (ret) {
					console.log(ret);
					var message = ret.msg;
					var msgArr = message.split("&");
					var itemid, temp, first, orfirst;
					for (var i = 0; i < msgArr.length; i++) {
						temp = "-" + msgArr[i];
						first = temp.indexOf("-id=");
						orfirst = temp.indexOf("?id=");
						if (first > -1) {
							itemid = temp.substr(first + 4, temp.length - first - 4);
						} else if (orfirst > -1) {
							itemid = temp.substr(orfirst + 4, temp.length - orfirst - 4);
						}
					}
					autoOpenItemById(itemid);
				}
			});
		}

		function autoOpenItemById(itemid) {
			var param = {
				itemid : itemid,
				mmpid : "mm_114019109_0_0"
			};
			console.log(param);
			alibaichuan.showTaokeItemById(param, function(ret, err) {
				console.log(ret);
				if (ret) {
					setinnerHTML(JSON.stringify(ret));
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function getAliOpen() {
			alibaichuan.showLogin(function(ret, err) {
				if (ret) {
				console.log(ret);
					document.getElementById("mayicon").src = ret.avatarUrl;
					var innerText = "昵称：" + ret.userNick + "<br/>授权码：" + ret.authCode + "<br/>时间：" + ret.loginTime + "<br/>用户ID：" + ret.userId;
					setinnerHTML(innerText);
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function getUserInfo() {
			alibaichuan.getUserInfo(function(ret, err) {
				if (ret) {
					//console.log("用户信息 ret - " + JSON.stringify(ret));
					document.getElementById("mayicon").src = ret.avatarUrl;
					var innerText = "昵称：" + ret.userNick + "<br/>授权码：" + ret.authCode + "<br/>时间：" + ret.loginTime + "<br/>用户ID：" + ret.userId;
					setinnerHTML(innerText);
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function logout() {
			alibaichuan.logout(function(ret, err) {
				if (ret) {
					setinnerHTML(JSON.stringify(ret));
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function openMyCart() {
			alibaichuan.openMyCart(function(ret, err) {
				if (ret) {
					setinnerHTML(JSON.stringify(ret));
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function myOrdersPage() {
			alibaichuan.myOrdersPage(function(ret, err) {
				if (ret) {
					setinnerHTML(JSON.stringify(ret));
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function showTaokeItemById() {
			var param = {
				itemid : "522997347023",
				mmpid : "mm_114019109_0_0"
			};
			alibaichuan.showTaokeItemById(param, function(ret, err) {
				if (ret) {
					setinnerHTML(JSON.stringify(ret));
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function showTaokeItemByOpenId() {
			var param = {
				openid : "AAGMLk9FACJvEVXfLXXUtbjt",
				mmpid : "mm_114019109_0_0"
			};
			alibaichuan.showTaokeItemByOpenId(param, function(ret, err) {
				if (ret) {
					setinnerHTML(JSON.stringify(ret));
				} else {
					setinnerHTML(JSON.stringify(err));
				}
			});
		}

		function setinnerHTML(neir) {
			document.getElementById("myinfo").innerHTML = neir;
		}
	</script>
</html>